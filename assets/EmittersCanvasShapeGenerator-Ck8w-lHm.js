import{J as D,W as O,i as $,a0 as C,I as B}from"./index-B5p0OL-A.js";import{E as S}from"./EmitterShapeBase-4KcS34Iy.js";const f={x:0,y:0},E=0;function w(h,e,i,a=!0){const s=h.getImageData(f.x,f.y,e.width,e.height).data;a&&h.clearRect(f.x,f.y,e.width,e.height);const t=[];for(let n=0;n<s.length;n+=i){const r=n/i,l={x:r%e.width,y:Math.floor(r/e.width)};t[l.y]||(t[l.y]=[]);const o={r:0,g:1,b:2,a:3},c=255;t[l.y][l.x]={r:s[n+o.r],g:s[n+o.g],b:s[n+o.b],a:s[n+o.a]/c}}return{pixels:t,width:Math.min(...t.map(n=>n.length)),height:t.length}}function I(h,e){const i=new Image;i.crossOrigin="Anonymous";const a=new Promise((s,t)=>{i.onerror=t,i.onload=()=>{const n=document.createElement("canvas");n.width=i.width,n.height=i.height;const r=n.getContext("2d");if(!r)return t(new Error(`${D} Could not get canvas context`));r.drawImage(i,f.x,f.y,i.width,i.height,f.x,f.y,n.width,n.height),s(w(r,n,e))}});return i.src=h,a}function P(h,e,i){const a=document.createElement("canvas"),s=a.getContext("2d"),{font:t,text:n,lines:r,color:l}=h;if(!n||!s)return;const o=n.split(r.separator),c=O(t.size)?`${t.size}px`:t.size,g=[];let p=0,y=0;for(const u of o){s.font=`${t.style||""} ${t.variant||""} ${t.weight||""} ${c} ${t.family}`;const x=s.measureText(u),m={measure:x,text:u,height:x.actualBoundingBoxAscent+x.actualBoundingBoxDescent,width:x.width};p=Math.max(p||E,m.width),y+=m.height+r.spacing,g.push(m)}a.width=p,a.height=y;let d=0;for(const u of g)s.font=`${t.style||""} ${t.variant||""} ${t.weight||""} ${c} ${t.family}`,i?(s.fillStyle=l,s.fillText(u.text,f.x,d+u.measure.actualBoundingBoxAscent)):(s.strokeStyle=l,s.strokeText(u.text,f.x,d+u.measure.actualBoundingBoxAscent)),d+=u.height+r.spacing;return w(s,a,e)}const T=100,v=.5;class A extends S{constructor(e,i,a,s){super(e,i,a,s);const t=s.filter,n=0;let r=l=>l.a>n;if(t!==void 0)if($(t)){if(Object.hasOwn(window,t)){const l=window[t];C(l)&&(r=l)}}else r=t;this.filter=r,this.scale=s.scale,this.pixelData={pixels:[],height:0,width:0}}async init(){let e;const i=this.options,a=i.selector,s=i.pixels,t=i.image,n=i.element,r=i.text,l=s.offset;if(t){const o=t.src;if(!o)return;e=await I(o,l)}else if(r){const o=P(r,l,this.fill);if(!o)return;e=o}else if(n??a){const o=n??(a&&document.querySelector(a));if(!o)return;const c=o.getContext("2d");if(!c)return;e=w(c,o,l)}e&&(this.pixelData=e)}randomPosition(){const{height:e,width:i}=this.pixelData,a=this.pixelData,s=this.position,t=this.scale,n={x:s.x-i*t*v,y:s.y-e*t*v};for(let r=0;r<T;r++){const l=Math.floor(B()*i*e),o={x:l%i,y:Math.floor(l/i)},c=a.pixels[o.y][o.x];if(this.filter(c))return{position:{x:o.x*t+n.x,y:o.y*t+n.y},color:{...c},opacity:c.a}}return null}resize(e,i){super.resize(e,i)}}class b{constructor(){this.offset=4}load(e){e&&e.offset!==void 0&&(this.offset=e.offset)}}class z{constructor(){this.family="Verdana",this.size=32,this.style="",this.variant="",this.weight=""}load(e){e&&(e.family!==void 0&&(this.family=e.family),e.size!==void 0&&(this.size=e.size),e.style!==void 0&&(this.style=e.style),e.variant!==void 0&&(this.variant=e.variant),e.weight!==void 0&&(this.weight=e.weight))}}class F{constructor(){this.separator=`
`,this.spacing=0}load(e){e&&(e.separator!==void 0&&(this.separator=e.separator),e.spacing!==void 0&&(this.spacing=e.spacing))}}class M{constructor(){this.color="#000000",this.font=new z,this.lines=new F,this.text=""}load(e){e&&(e.color!==void 0&&(this.color=e.color),this.font.load(e.font),this.lines.load(e.lines),e.text!==void 0&&(this.text=e.text))}}const R=0;class W{constructor(){this.filter=e=>e.a>R,this.pixels=new b,this.scale=1,this.selector="",this.text=new M}load(e){e&&(e.element!==void 0&&(this.element=e.element),e.filter!==void 0&&(this.filter=e.filter),this.pixels.load(e.pixels),e.scale!==void 0&&(this.scale=e.scale),e.selector!==void 0&&(this.selector=e.selector),e.image!==void 0&&(this.image=e.image),this.text.load(e.text))}}class q{generate(e,i,a,s){const t=new W;return t.load(s),new A(e,i,a,t)}}export{q as EmittersCanvasShapeGenerator};
