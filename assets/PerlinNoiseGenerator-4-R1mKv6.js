import{O as g,d as Z,I as z}from"./index-CKF4anYh.js";class a{constructor(t,s,e){this.x=t,this.y=s,this.z=e}dot2(t,s){return this.x*t+this.y*s}dot3(t,s,e){return this.dot2(t,s)+this.z*e}}class G{constructor(){this._grad3=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)],this._p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._gradP=new Array(512),this._perm=new Array(512)}noise2d(t,s){const{_gradP:e,_perm:n}=this;let i=Math.floor(t),o=Math.floor(s);t=t-i,s=s-o,i=i&255,o=o&255;const r=e[i+n[o]].dot2(t,s),h=e[i+n[o+1]].dot2(t,s-1),l=e[i+1+n[o]].dot2(t-1,s),p=e[i+1+n[o+1]].dot2(t-1,s-1),c=this._fade(t);return this._lerp(this._lerp(r,l,c),this._lerp(h,p,c),this._fade(s))}noise3d(t,s,e){const{_gradP:n,_perm:i}=this;let o=Math.floor(t),r=Math.floor(s),h=Math.floor(e);t=t-o,s=s-r,e=e-h,o=o&255,r=r&255,h=h&255;const l=n[o+i[r+i[h]]].dot3(t,s,e),p=n[o+i[r+i[h+1]]].dot3(t,s,e-1),c=n[o+i[r+1+i[h]]].dot3(t,s-1,e),u=n[o+i[r+1+i[h+1]]].dot3(t,s-1,e-1),m=n[o+1+i[r+i[h]]].dot3(t-1,s,e),M=n[o+1+i[r+i[h+1]]].dot3(t-1,s,e-1),P=n[o+1+i[r+1+i[h]]].dot3(t-1,s-1,e),F=n[o+1+i[r+1+i[h+1]]].dot3(t-1,s-1,e-1),f=this._fade(t),v=this._fade(s),w=this._fade(e);return this._lerp(this._lerp(this._lerp(l,m,f),this._lerp(p,M,f),w),this._lerp(this._lerp(c,P,f),this._lerp(u,F,f),w),v)}seed(t){const{_grad3:s,_gradP:e,_perm:n,_p:i}=this;let o=t;o>0&&o<1&&(o*=65536),o=Math.floor(o),o<256&&(o|=o<<8);for(let r=0;r<256;r++){const h=r&1?i[r]^o&255:i[r]^o>>8&255;n[r]=n[r+256]=h,e[r]=e[r+256]=s[h%12]}}_fade(t){return t*t*t*(t*(t*6-15)+10)}_lerp(t,s,e){return(1-e)*t+e*s}}const A=2,O=Math.PI*A,d={draw:!1,size:20,increment:.004,columns:0,rows:0,width:0,height:0,factor:{angle:.02,length:.01},offset:{x:4e4,y:4e4}};class b{constructor(){this._calculateField=()=>{const{field:t,noiseGen:s,options:e}=this,n=e.factor.length,i=e.factor.angle;for(let o=0;o<e.columns;o++){const r=t[o];for(let h=0;h<e.rows;h++){const l=r[h];l.length=s.noise3d(o*n+e.offset.x,h*n+e.offset.y,this.noiseZ),l.angle=s.noise3d(o*i,h*i,this.noiseZ)*O}}},this._drawField=t=>{const{field:s,options:e}=this;for(let n=0;n<e.columns;n++){const i=s[n];for(let o=0;o<e.rows;o++){const r=i[o],{angle:h,length:l}=r;t.setTransform(1,0,0,1,n*this.options.size,o*this.options.size),t.rotate(h),t.strokeStyle="white",t.beginPath(),t.moveTo(0,0),t.lineTo(0,this.options.size*l),t.stroke(),t.setTransform(1,0,0,1,0,0)}}},this._initField=()=>{const{columns:t,rows:s}=this.options;this.field=new Array(t);for(let e=0;e<t;e++){this.field[e]=new Array(s);for(let n=0;n<s;n++)this.field[e][n]=g.origin}},this.noiseGen=new G,this.field=[],this.noiseZ=0,this.options=Z({},d)}generate(t){var o;const s=t.getPosition(),{size:e}=this.options,n={x:Math.max(Math.floor(s.x/e),0),y:Math.max(Math.floor(s.y/e),0)},{field:i}=this;return(o=i==null?void 0:i[n.x])!=null&&o[n.y]?i[n.x][n.y].copy():g.origin}init(t){this.container=t,this._setup()}reset(){}update(){this.container&&(this._calculateField(),this.noiseZ+=this.options.increment,this.options.draw&&this.container.canvas.draw(t=>this._drawField(t)))}_resetField(){const t=this.container;if(!t)return;const s=t.actualOptions.particles.move.path.options,{options:e}=this;e.size=s.size>0?s.size:d.size,e.increment=s.increment>0?s.increment:d.increment,e.draw=!!s.draw;const n=s.offset;e.offset.x=(n==null?void 0:n.x)??d.offset.x,e.offset.y=(n==null?void 0:n.y)??d.offset.y;const i=s.factor;e.factor.angle=(i==null?void 0:i.angle)??d.factor.angle,e.factor.length=(i==null?void 0:i.length)??d.factor.length,e.width=t.canvas.size.width,e.height=t.canvas.size.height,this.options.seed=s.seed,this.noiseGen.seed(this.options.seed??z()),e.columns=Math.floor(this.options.width/this.options.size)+1,e.rows=Math.floor(this.options.height/this.options.size)+1,this._initField()}_setup(){this.noiseZ=0,this._resetField(),window.addEventListener("resize",()=>this._resetField())}}export{b as PerlinNoiseGenerator};
